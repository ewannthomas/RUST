
*******************Vulnerability Score***********************
*Merging A (VS) with E1
  use "E:\RUST Primary\Vulnerability Score.dta" 
  merge 1:1 KEY using "E:\RUST Primary\Section E1.dta" , keepusing(Defec_place  Toilet_inHH Toilet_inHH_type Total_cost Probs_defec_facility_1 Reason_NO_inHH_1)
  drop _merge

*Merging A (VS) with E2  
  merge 1:1 KEY using "E:\RUST Primary\Section E2.dta" , keepusing(Grey_wat_dispo Black_wat_dispo)
  drop _merge

*Merging A (VS) with E3 
  merge 1:1 KEY using "E:\RUST Primary\Section E3.dta" , keepusing(Waste_segreg_dispo Mixed_waste_dispo_place)
  drop _merge

*Merging A (VS) with E5  
  merge 1:1 KEY using "E:\RUST Primary\Section E5.dta" , keepusing(Mhm_facility_privacy Diff_toilet_while_Periods Reason_diff_toilet1_1 Materials_used)
  drop _merge

*dropping HH ID
  drop HH_ID

  
  
**Merging C&A to VS
  merge 1:1 KEY using "E:\RUST Primary\Section C&A.dta", keepusing(Purpose_SBM Subsidy_toilet_construct Edu_sani_hygiene Community_toilet_access Public_toilet_access Solid_waste_dispo Safe_access_toilets Privacy_toilet_use Improved_health Fin_toilet_construct_inHH Provision_pub_toilet Reduce_open_defec Better_toilet_women Treat_dispo_Hum_waste Treat_dispo_solid_waste)
  drop _merge

  
  

*******************Vulnerability Score Creation***********************

**Recoding Black Water Disposal
  recode Black_wat_dispo (1=1 "goes into built drain") (2=2 "goes into sewerage system" ) (3=3 "goes into open drain" ) (4=4 "in septic tank") (5=99 "Other"), gen ( Black_wat_dispo_recode)

**Recoding Toilet Type in HH
  recode Toilet_inHH_type (.=0) if Toilet_inHH=="no" | Toilet_inHH=="yes" , gen ( Toilet_inHH_recode )
  label define Toilet_type 0 "No Facility in HH", add
  label values Toilet_inHH_recode Toilet_type

**VS of Defec_Place
  recode Defec_place (1=0) (2=1) (3=1) (4=2) (99=1), gen(VS_Defec_Place)  label variable VS_Defec_Place "VS of Defecation Place"
  label variable VS_Defec_Place "VS of Defecation Place"

**VS of Toilet in HH
  recode Toilet_inHH_recode (0=2) (11=0) (12=0) (13=0) (14=2) (18=2) (22=0) (23=1) (32=0) (41=2) (99=2), gen ( VS_Toilet_inHH )
  label variable VS_Toilet_inHH "VS of Toilet in HH "

**VS of Grey water Disposal  
  recode Grey_wat_dispo (1=0) (2=0) (3=1) (4=0) (99=1), gen( VS_Grey_wat_dispo )
  label variable Grey_wat_dispo "VS of Grey water Disposal "

**Total HH VS
  egen VS_Total= rowtotal ( VS_Defec_Place VS_Toilet_inHH VS_Grey_wat_dispo ), missing
  label variable VS_Total "Total HH VS"

  
****************Logistic Regression*************
**Recoding Defec_Place
  recode Defec_place (1/3=0 " Has Latrine Access") (4=1 "Open Defecation") (99=0), gen ( Defec_place_recode )

**Recoding Gen_Ed
  recode Gen_Ed (17=0 "Not Literate") (1/8=1 "Primary") (9/13=2 "Secondary") (13/16=3 "Tertiary") (99=0), gen( Gen_Ed_recode)

**Recoding and Encoding Sector
  encode Sector, gen(Rural_Urban)
  recode Rural_Urban (1=1 "Peri Urban") (2=2 "Rural") (3=3 "Urban") (4=1), gen(sector)
  label variable sector "Sector"

**mlogit
  global IndepVars age ib3.Gender ib2.sector ib1.Sc_Grp ib3.Religion HH_Size ib1.Residence_Stat ib0.Gen_Ed_recode Total_HH_Income  

  mlogit Defec_place_recode $IndepVars, allbase rrr base(0)

  
  
  ***********Tabs after Mlogit
  foreach var in Subsidy_toilet_construct Edu_sani_hygiene Community_toilet_access Public_toilet_access Solid_waste_dispo Safe_access_toilets Privacy_toilet_use Improved_health {
tab2 Defec_place_recode `var', r
}

foreach var in Fin_toilet_construct_inHH Provision_pub_toilet Reduce_open_defec Better_toilet_women Treat_dispo_Hum_waste Treat_dispo_solid_waste {
tab2 `var' Defec_place_recode, r
}

foreach var in Gender sector Sc_Grp Religion Residence_Stat Gen_Ed_recode {
tabodds Defec_place_recode `var', or base(0)
}

foreach var in Gender sector Sc_Grp Religion Residence_Stat Gen_Ed_recode {
tab2 `var' Defec_place_recode, col r
}

*************Merging VI & E4&F**********
use "E:\RUST Primary\Vulnerability Score.dta"
drop Sector
drop sector
merge 1:1 KEY using "E:\RUST Primary\Section E4&F.dta"
drop _merge
br
drop Rural_Urban
drop Gen_Ed_Specific Emp_Sector_Specific Sc_Grp_Specific Residence_Stat_Specific

merge 1:1 KEY using "E:\RUST Primary\Section E3.dta", keepusing(Waste_mgt_sys_satis Waste_mgt_serv_fee_expect)
drop _merge
